<div ng-switch on="fieldDescriptor.type">
    <div ng-switch-when="Document">
        <a ng-show="canDelete();" class="btn btn-xs btn-primary" ng-click="delItem(arrIdx);">
            <span class="glyphicon glyphicon-minus"></span>
        </a>
        <div style="width: {{ maxFieldNameLength(descriptor) | labelWidth }}">
            <a class="btn btn-xs btn-default collapse-btn pull-left" ng-click="isCollapsed = !isCollapsed">
                <span ng-show="isCollapsed" class="glyphicon glyphicon-chevron-right"></span>
                <span ng-show="!isCollapsed" class="glyphicon glyphicon-chevron-down"></span>
            </a>
            <label class="pull-right">{{ fieldName }}</label>
            <br style="clear: both;"/>
        </div>
        <ul collapse="isCollapsed">
            <li ng-controller="EntityDescriptorController" ng-repeat="descriptor in children" ng-init="init($parent.fieldValue, descriptor);">
                <div ng-include="'app/partials/entity-descriptor.html'"></div>
            </li>
        </ul>
    </div>
    <div ng-switch-when="Array">
        <a ng-show="canDelete();" class="btn btn-xs btn-primary" ng-click="delItem(arrIdx);">
            <span class="glyphicon glyphicon-minus"></span>
        </a>
        <div style="width: {{ maxFieldNameLength(descriptor) | labelWidth }}">
            <a class="btn btn-xs btn-default collapse-btn pull-left" ng-click="isCollapsed = !isCollapsed">
                <span ng-show="isCollapsed" class="glyphicon glyphicon-chevron-right"></span>
                <span ng-show="!isCollapsed" class="glyphicon glyphicon-chevron-down"></span>
            </a>
            <label class="pull-right">{{ fieldName }}</label>
            <br style="clear: both;"/>
        </div>
        <div ng-if="fieldDescriptor.enum">
            <ul collapse="isCollapsed">
                <li>
                    <fieldset ng-disabled="isReadOnly();">
                        <div  ng-repeat="choice in fieldDescriptor.enum">
                            <input type="checkbox"
                                   ng-checked="fieldValue.indexOf(choice) >= 0"
                                   ng-click="toggleChoice(choice)">
                            <label style="margin-left: 4px;">{{ choice }}</label>
                        </div>
                    </fieldset>
                </li>
            </ul>
        </div>
        <div ng-if="!fieldDescriptor.enum">
            <ul collapse="isCollapsed">
                <li ng-controller="EntityDescriptorController" ng-init="init($parent.fieldValue, $parent.children[0], $index);" ng-repeat="value in fieldValue track by $index">
                    <div ng-include="'app/partials/entity-descriptor.html'"></div>
                </li>
                <li>
                    <a ng-show="canAdd();" class="btn btn-xs btn-primary" ng-click="addItem();">
                        <span class="glyphicon glyphicon-plus">Add</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <ng-form ng-switch-when="ObjectId" class="form-inline css-form" role="form" novalidate>
        <div class="form-group">
            <a ng-show="canDelete();" class="btn btn-xs btn-primary" ng-click="delItem(arrIdx);">
                <span class="glyphicon glyphicon-minus"></span>
            </a>
            <fieldset ng-disabled="isReadOnly();">
                <label style="width: {{ maxFieldNameLength(descriptor) | labelWidth }}" class="entity-label left-border" for="{{ path }}">{{ fieldName }}</label>
                <input  ng-if="fieldDescriptor.ref" type="text" class="form-control input-sm" disabled="disabled" id="{{ path }}" ng-model="fieldValue" required="{{ !!fieldDescriptor.required }}" placeholder="{{ fieldDescriptor.comment }}">
                <button ng-if="fieldDescriptor.ref && !isReadOnly()" class="btn btn-sm btn-info" ng-click="chooseEntity();">Choose</button>

                <input ng-if="!fieldDescriptor.ref" type="text" class="form-control input-sm" id="{{ path }}" placeholder="{{ fieldDescriptor.comment || fieldDescriptor.type }}" ng-change="valueChanged(fieldValue);" ng-model="fieldValue" required="{{ !!fieldDescriptor.required }}">
            </fieldset>
        </div>
    </ng-form>
    <ng-form ng-switch-default class="form-inline css-form" role="form" novalidate>
        <div class="form-group">
            <fieldset ng-disabled="isReadOnly();">
                <a ng-show="canDelete();" class="btn btn-xs btn-primary" ng-click="delItem(arrIdx);">
                    <span class="glyphicon glyphicon-minus"></span>
                </a>
                <label ng-if="isItem()" for="{{ path }}">{{ fieldName }}</label>
                <label style="width: {{ maxFieldNameLength(descriptor) | labelWidth }}" ng-if="!isItem()" class="entity-label left-border" for="{{ path }}">{{ fieldName }}</label>
                <select ng-if="fieldDescriptor.enum" ng-options="choice for choice in fieldDescriptor.enum" ng-model="fieldValue" ng-change="valueChanged(fieldValue)" required="{{ !!fieldDescriptor.required }}"></select>

                <input ng-if="!fieldDescriptor.enum" type="{{ inputType() }}" class="form-control input-sm" id="{{ path }}" placeholder="{{ fieldDescriptor.comment || fieldDescriptor.type }}" ng-change="valueChanged(fieldValue);" ng-model="fieldValue" required="{{ !!fieldDescriptor.required }}">

            </fieldset>
        </div>
    </form>
</div>
